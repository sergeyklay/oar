---
description: Enforce Node.js 24 environment and package manager rules via nvm.
globs: **/*
alwaysApply: true
---

# Environment & Runtime Constraints

**CRITICAL:** This project requires **Node.js 24+**.
The system environment might default to an older version. You MUST ensure the correct version is active before running commands.

## Terminal Command Execution Rules

Whenever you (the AI) run a terminal command involving `node`, `npm`, `npx`, or database migrations:

1.  **Check Version First:** Do not assume the environment is correct.
2.  **Force NVM:** Prepend `nvm use` or explicit sourcing if the shell might be non-interactive.
    * *Preferred pattern:* `source ~/.nvm/nvm.sh && nvm use && npm run dev` (or appropriate command).
    * *Alternative:* Explicitly verify via `node -v` before complex operations.
3.  **Strict Engine:** If you see an error related to "engine compatibility" or "syntax error" (unexpected token '?'), it means you are on an old Node version. **IMMEDIATELY** switch to Node 24 and retry.

## Package Manager

- **ONLY use `npm`** - `yarn`, `pnpm`, `bun` or any other package manager are forbidden to prevent lockfile conflicts.
- **Lock file committed** - `package-lock.json` must be in version control and never ignored.
- **CI Integrity** - Use `npm ci` for clean, reproducible installs in pipelines or fresh setups.
- **Segregation** - Strictly separate `dependencies` (prod) from `devDependencies` (build/test/lint).
- **Respect `.nvmrc` at the project root** - This file defines the recommended Node.js version for the project.

## Essential Commands

~~~bash
# ✅ DO: Correct nvm usage
nvm use 24

# ✅ DO: Correct npm usage
npm install package-name           # Add new dependency (updates lockfile)
npm install -D package-name        # Add development dependency
npm ci                             # Clean install from lockfile (Strict)
npm run script-name                # Run scripts defined in package.json
npx tool-name                      # Run binaries without global install
npm audit fix                      # Fix security vulnerabilities

# ❌ DON'T: Forbidden actions
yarn add package-name              # Never mix package managers
npm install -g package-name        # Avoid global installs (use npx or devDeps)
rm -rf node_modules                # Use 'npm ci' instead of manual cleaning
# Manually editing package-lock.json
~~~

## Quick Reference

~~~bash
# Add production dependency
npm install axios

# Add development/testing dependency
npm install -D jest typescript

# specific version
npm install react@18.2.0

# Install dependencies for an existing project (Best Practice)
npm ci

# Update minor/patch versions based on package.json constraints
npm update
~~~

## Critical Rules

- **NEVER use Yarn/PNPM** - npm only in this project.
- **Commit package-lock.json** - Always version control the lock file; do not add to .gitignore.
- **Prefer `npm ci`** - When setting up the repo or in CI/CD, use `ci` to ensure you get exactly what is in the lockfile.
- **Audit Regularly** - Run `npm audit` when adding major dependencies.
